<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>カードコントローラー</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #222; color: white; padding: 20px; }
        .setup-area { background: #333; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        
        /* クラス選択タブ */
        .tabs { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; cursor: pointer; background: #444; border: none; color: white; border-radius: 5px; }
        .tab-btn.active { background: #007bff; }

        /* カード一覧 */
        .card-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; display: none; }
        .card-list.active { display: grid; }
        .card-item { cursor: pointer; text-align: center; background: #333; padding: 5px; border-radius: 5px; transition: 0.2s; }
        .card-item:hover { background: #555; transform: scale(1.05); }
        .card-item img { width: 100%; border-radius: 3px; }

        /* 操作ボタン */
        .controls { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; }
        .hide-btn { padding: 15px 30px; background: #dc3545; color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1.2rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

    <div class="setup-area">
        <input type="text" id="target-id" placeholder="OBSに表示されたIDを入力">
        <button onclick="connectToOBS()">1. 接続</button>
        <span id="conn-status">未接続</span>
    </div>

    <div class="tabs" id="tabs">
        </div>

    <div id="card-containers">
        </div>

    <div class="controls">
        <button class="hide-btn" onclick="hideCard()">カードを非表示にする</button>
    </div>

    <script>
        const peer = new Peer();
        let conn;

        // クラスとカードの定義（ここを実際のファイル名に合わせて書き換えてください）
        const classes = {
            "エルフ": ["card1.png", "card2.png"],
            "ロイヤル": ["card1.png", "card2.png"],
            "ウィッチ": ["card1.png"],
            "ドラゴン": ["card1.png"],
            "ナイトメア": ["card1.png"],
            "ビショップ": ["card1.png"],
            "ネメシス": ["card1.png"]
        };

        // 初期生成
        const tabContainer = document.getElementById('tabs');
        const listContainer = document.getElementById('card-containers');

        Object.keys(classes).forEach((className, index) => {
            // タブ生成
            const btn = document.createElement('button');
            btn.innerText = className;
            btn.className = 'tab-btn' + (index === 0 ? ' active' : '');
            btn.onclick = () => switchTab(className, btn);
            tabContainer.appendChild(btn);

            // カード一覧生成
            const div = document.createElement('div');
            div.id = 'list-' + className;
            div.className = 'card-list' + (index === 0 ? ' active' : '');
            
            classes[className].forEach(fileName => {
                const imgPath = `images/${className}/${fileName}`;
                const item = document.createElement('div');
                item.className = 'card-item';
                item.innerHTML = `<img src="${imgPath}"><div style="font-size:10px">${fileName}</div>`;
                item.onclick = () => sendCard(imgPath);
                div.appendChild(item);
            });
            listContainer.appendChild(div);
        });

        function switchTab(className, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.card-list').forEach(l => l.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('list-' + className).classList.add('active');
        }

        // 通信処理
        function connectToOBS() {
            const id = document.getElementById('target-id').value;
            conn = peer.connect(id);
            conn.on('open', () => {
                document.getElementById('conn-status').innerText = "✅ 接続完了";
                document.getElementById('conn-status').style.color = "#00ff00";
            });
        }

        function sendCard(url) {
            if(conn) conn.send({ action: 'show', url: url });
        }

        function hideCard() {
            if(conn) conn.send({ action: 'hide' });
        }
    </script>
</body>
</html>
