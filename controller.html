<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>配信コントローラー</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; padding: 20px; margin-bottom: 100px; }
        .setup-area { background: #333; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #444; }
        input[type="text"] { padding: 8px; border-radius: 4px; border: 1px solid #555; background: #222; color: white; }
        
        /* テキスト入力エリアを強調 */
        .text-input-area { background: #2c3e50; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #3498db; }

        .tabs { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .tab-btn { padding: 12px 20px; cursor: pointer; background: #444; border: none; color: white; border-radius: 4px; font-weight: bold; }
        .tab-btn.active { background: #3498db; }

        .card-list { display: none; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .card-list.active { display: grid; }
        .card-item { cursor: pointer; background: #333; padding: 8px; border-radius: 6px; text-align: center; border: 2px solid transparent; transition: 0.2s; }
        .card-item:hover { border-color: #3498db; background: #444; }
        .card-item img { width: 100%; border-radius: 4px; margin-bottom: 5px; }

        .controls { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.9); padding: 20px; box-sizing: border-box; text-align: center; }
        .hide-btn { padding: 15px 50px; background: #e74c3c; color: white; border: none; border-radius: 4px; font-size: 18px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="setup-area">
        接続先ID: <input type="text" id="target-id" placeholder="OBSのIDを入力">
        <button onclick="connectToOBS()" style="padding: 8px 20px;">接続</button>
        <span id="status">未接続</span>
    </div>

    <div class="text-input-area">
        <strong>表示したい説明文（空欄ならデフォルトを表示）：</strong><br>
        <input type="text" id="custom-text" style="width: 90%; margin-top: 10px; font-size: 16px;" placeholder="ここに文字を入力してから画像をクリック">
    </div>

    <div class="tabs" id="tabs"></div>
    <div id="card-containers"></div>

    <div class="controls">
        <button class="hide-btn" onclick="hideCard()">カードとテキストを消す</button>
    </div>

    <script>
        const peer = new Peer();
        let conn;

        // 【ここを編集】各フォルダ内の画像リストを定義
        const classes = {
            "エルフ": [
                { name: "リノセウス", file: "リノセウス.png", desc: "G" },
                
            ],
            "ロイヤル": [
                { name: "アルベール", file: "アルベール.png", desc: "【エンハンス_9】相手の場のフォロワーすべてに3ダメージ。これは「1ターンに2回攻撃できる。」を持つ。\n【疾走】" },
                { name: "オルオーン", file: "オルオーン.png", desc: "自分のターン終了時、これが進化前なら、相手の場のフォロワーすべてに7ダメージ。進化後なら、「場の他のフォロワーか自分のリーダーか相手のリーダーからランダム1枚に7ダメージ。」を3回行う。"
            ],
            "ウィッチ": [{ name: "ドロシー", file: "dorothy.png", desc: "デッキ加速" }],
            "ドラゴン": [{ name: "ほーちゃん", file: "ほーちゃん.png", desc: "【ファンファーレ】自分のデッキすべてのコストを半分にする。" }],
            "ナイトメア": [{ name: "ケルベロス", file: "cerberus.png", desc: "トークン生成" }],
            "ビショップ": [{ name: "イージス", file: "aegis.png", desc: "無敵の守り" }],
            "ネメシス": [{ name: "イマリ", file: "イマリ.png", desc: "【ファンファーレ】自分の手札1枚を選ぶ。それを捨てる。自分のデッキからスペル1枚を引く。\n自分がスペルをプレイしたとき、これが進化後なら、『イマリの小鬼』1枚を自分の場に出す。\n【超進化時】自分のデッキからコスト1のスペル2種類を引く。" }]
        };

        const tabContainer = document.getElementById('tabs');
        const listContainer = document.getElementById('card-containers');

        // UI生成
        Object.keys(classes).forEach((className, index) => {
            const btn = document.createElement('button');
            btn.innerText = className;
            btn.className = 'tab-btn' + (index === 0 ? ' active' : '');
            btn.onclick = () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.card-list').forEach(l => l.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById('list-' + className).classList.add('active');
            };
            tabContainer.appendChild(btn);

            const div = document.createElement('div');
            div.id = 'list-' + className;
            div.className = 'card-list' + (index === 0 ? ' active' : '');
            
            classes[className].forEach(card => {
                const imgPath = `images/${className}/${card.file}`;
                const item = document.createElement('div');
                item.className = 'card-item';
                item.innerHTML = `<img src="${imgPath}"><div>${card.name}</div>`;
                // クリック時にテキストボックスの内容を優先して送る
                item.onclick = () => {
                    const customText = document.getElementById('custom-text').value;
                    const textToSend = customText || card.desc;
                    sendCard(imgPath, textToSend);
                };
                div.appendChild(item);
            });
            listContainer.appendChild(div);
        });

        function connectToOBS() {
            const id = document.getElementById('target-id').value;
            conn = peer.connect(id);
            conn.on('open', () => {
                document.getElementById('status').innerText = "✅ 接続完了";
                document.getElementById('status').style.color = "#00ff00";
            });
        }

        function sendCard(url, text) {
            if(conn) conn.send({ action: 'show', url: url, text: text });
        }

        function hideCard() {
            if(conn) {
                conn.send({ action: 'hide' });
                document.getElementById('custom-text').value = ""; // 入力欄をクリア
            }
        }
    </script>
</body>
</html>
